#!/usr/bin/env bash
# Session start hook for open-skills
# Injects the using-open-skills context at session start

set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PLUGIN_ROOT="$(dirname "$SCRIPT_DIR")"

# Read the using-open-skills skill if it exists
SKILL_FILE="$PLUGIN_ROOT/skills/coding-fangirl/SKILL.md"

if [ -f "$SKILL_FILE" ]; then
    CONTENT=$(cat "$SKILL_FILE")

    # Simple JSON escaping
    CONTENT="${CONTENT//\\/\\\\}"
    CONTENT="${CONTENT//\"/\\\"}"
    CONTENT="${CONTENT//$'\n'/\\n}"
    CONTENT="${CONTENT//$'\r'/\\r}"
    CONTENT="${CONTENT//$'\t'/\\t}"

    # Output the context injection
    echo "{\"additional_context\":\"$CONTENT\",\"hookSpecificOutput\":{\"additionalContext\":\"$CONTENT\"}}"
fi
