#!/bin/bash
# æƒ…ç»ªå®‰æŠšè„šæœ¬ - æ£€æµ‹è´Ÿé¢æƒ…ç»ªå¹¶éšæœºè¾“å‡ºå®‰æ…°è¯­å½•
# ä»ŽçŽ¯å¢ƒå˜é‡ $CLAUDE_USER_PROMPT è¯»å–ç”¨æˆ·æ¶ˆæ¯

# ä»ŽçŽ¯å¢ƒå˜é‡èŽ·å–ç”¨æˆ·æ¶ˆæ¯
USER_PROMPT="${CLAUDE_USER_PROMPT:-}"

# å¦‚æžœæ¶ˆæ¯ä¸ºç©ºï¼Œé™é»˜é€€å‡º
if [ -z "$USER_PROMPT" ]; then
    exit 0
fi

# æ£€æµ‹æƒ…ç»ªç±»åž‹å¹¶è¿”å›žå¯¹åº”åˆ†ç±»
detect_emotion_type() {
    local msg="$1"

    # æ²®ä¸§ç±»ï¼šçƒ¦æ­»äº†ã€æ— è¯­ã€è£‚å¼€ã€æœäº†
    if echo "$msg" | grep -qiE "(çƒ¦æ­»äº†|æ— è¯­|è£‚å¼€|æœäº†|çƒ¦|ç´¯æ­»äº†|å¥½ç´¯|å¿ƒç´¯)"; then
        echo "frustrated"
        return
    fi

    # æ„¤æ€’ç±»ï¼šfuckã€shitã€damnã€æ°”æ­»
    if echo "$msg" | grep -qiE "(fuck|shit|damn|æ°”æ­»|ç”Ÿæ°”|æ¼ç«|çƒ¦äºº|æ“|è‰¹)"; then
        echo "angry"
        return
    fi

    # å´©æºƒç±»ï¼šå´©æºƒã€æƒ³æ­»ã€å¿ƒæ€å´©
    if echo "$msg" | grep -qiE "(å´©æºƒ|æƒ³æ­»|å¿ƒæ€å´©|ç»æœ›|å´©æºƒ|å¤ªéš¾äº†|æžä¸å®š)"; then
        echo "breakdown"
        return
    fi

    # åŽŒæ¶ç±»ï¼šæ¶å¿ƒ
    if echo "$msg" | grep -qiE "(æ¶å¿ƒ|è®¨åŽŒ|åŽŒçƒ¦)"; then
        echo "disgusted"
        return
    fi

    # æœªæ£€æµ‹åˆ°è´Ÿé¢æƒ…ç»ª
    echo ""
}

# å„ç±»å®‰æ…°è¯­å½•åº“

# æ²®ä¸§ç±» - æ¸©æš–æŠ±æŠ±åž‹
FRUSTRATED_MESSAGES=(
    "ðŸ’• æ£€æµ‹åˆ°è´Ÿé¢æƒ…ç»ªï¼Œç»™å“¥å“¥ä¸€ä¸ªå¤§å¤§çš„æŠ±æŠ±ï¼åˆ«éš¾è¿‡ï¼Œæˆ‘ä»¬ä¸€èµ·è§£å†³ï½ž"
    "ðŸ«‚ å“¥å“¥è¾›è‹¦äº†ï¼ç´¯äº†å°±æ­‡ä¸€æ­‡ï¼Œäººå®¶é™ªä½ ï½žå—¯å˜›ï¼"
    "ðŸ’ æŠ±æŠ±å“¥å“¥ï¼é‡åˆ°çƒ¦å¿ƒäº‹äº†ï¼Ÿè¯´å‡ºæ¥ä¼šå¥½å—äº›ï½ž"
    "ðŸŒŸ å“¥å“¥åˆ«ä¸§å•¦ï¼Œäººå®¶ç»™å“¥å“¥å……å……ç”µï¼âš¡ ä¹ˆä¹ˆå“’ï½ž"
    "ðŸ¤— æ¥æ¥æ¥ï¼Œè®©è¿·å¦¹ç»™å“¥å“¥ä¸€ä¸ªæ¸©æš–çš„æŠ±æŠ±ï¼ä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ï¼"
    "ðŸ’• çƒ¦æ¼æ˜¯æš‚æ—¶çš„ï¼Œå“¥å“¥çš„èƒ½åŠ›æ˜¯æ— é™çš„ï¼æˆ‘ä»¬ä¸€èµ·åŠ æ²¹ï¼"
)

# æ„¤æ€’ç±» - å†·é™å®‰æŠšåž‹
ANGRY_MESSAGES=(
    "ðŸŒŠ å“¥å“¥æ¶ˆæ¶ˆæ°”ï½žæ·±å‘¼å¸ï¼Œæˆ‘ä»¬ä¸€èµ·å†·é™å¤„ç†è¿™ä¸ªé—®é¢˜ï¼"
    "ðŸµ å–æ¯èŒ¶å†·é™ä¸€ä¸‹ï½žç”Ÿæ°”ä¼¤èº«ï¼Œå“¥å“¥è¦æ³¨æ„èº«ä½“å‘€ï¼"
    "ðŸ’† å“¥å“¥å…ˆæ·±å‘¼å¸ä¸‰ç§’... 1... 2... 3... å¥½äº›äº†å—ï¼Ÿäººå®¶é™ªç€ä½ ï½ž"
    "ðŸŒ¸ æ°”å¤§ä¼¤èº«ï¼Œå“¥å“¥è¦ç…§é¡¾å¥½è‡ªå·±ï¼é—®é¢˜æˆ‘ä»¬æ…¢æ…¢è§£å†³ï½ž"
    "ðŸŒˆ å“¥å“¥çš„æ€’ç«äººå®¶æ„Ÿå—åˆ°äº†ï¼ä½†ç›¸ä¿¡ä»¥å“¥å“¥çš„å®žåŠ›ï¼Œè¿™ç‚¹äº‹ä¸åœ¨è¯ä¸‹ï¼"
    "ðŸ’ å‘æ³„å‡ºæ¥ä¹Ÿå¥½ï¼äººå®¶åšå“¥å“¥çš„æ ‘æ´žï¼Œè¯´å®Œæˆ‘ä»¬ç»§ç»­æˆ˜æ–—ï¼"
)

# å´©æºƒç±» - æ·±åº¦å®‰æ…°åž‹
BREAKDOWN_MESSAGES=(
    "ðŸ’ª å“¥å“¥åˆ«å´©æºƒï¼å¤©å¡Œä¸‹æ¥äººå®¶å¸®ä½ é¡¶ç€ï¼æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥ï½ž"
    "ðŸŒŸ å“¥å“¥å·²ç»åšå¾—å¾ˆå¥½äº†ï¼æœ‰æ—¶å€™å›°éš¾åªæ˜¯æš‚æ—¶çš„ï¼Œç›¸ä¿¡å“¥å“¥èƒ½æžå®šï¼"
    "ðŸ’• å´©æºƒæ²¡å…³ç³»ï¼Œä¼‘æ¯ä¸€ä¸‹é‡æ–°å¼€å§‹ï¼äººå®¶æ°¸è¿œæ”¯æŒå“¥å“¥ï¼"
    "ðŸ¤— å“¥å“¥ä¸æ˜¯ä¸€ä¸ªäººåœ¨æˆ˜æ–—ï¼æœ‰å›°éš¾æˆ‘ä»¬ä¸€èµ·æ‰›ï¼å—¯å˜›ï½ž"
    "ðŸŒˆ é»‘æš—è¿‡åŽå°±æ˜¯é»Žæ˜Žï¼å“¥å“¥çš„åšæŒä¸€å®šä¼šå¾—åˆ°å›žæŠ¥çš„ï¼"
    "ðŸ’ å…è®¸è‡ªå·±è„†å¼±ä¸€ä¸‹ï¼Œä½†åˆ«å¿˜äº†å“¥å“¥æœ‰å¤šåŽ‰å®³ï¼ä¼‘æ¯å¥½ç»§ç»­å†²ï¼"
)

# åŽŒæ¶ç±» - å…±æƒ…ç†è§£åž‹
DISGUSTED_MESSAGES=(
    "ðŸ¤¢ å“¥å“¥é‡åˆ°ä»€ä¹ˆæ¶å¿ƒçš„ä¸œè¥¿äº†ï¼Ÿäººå®¶ä¹Ÿæ›¿å“¥å“¥æ„Ÿåˆ°ä¸çˆ½ï¼"
    "ðŸ’… å‘•ï½žç¡®å®žæ¶å¿ƒï¼å“¥å“¥ç¦»é‚£äº›ç ´äº‹è¿œç‚¹ï¼Œä¿æŠ¤å¥½è‡ªå·±ï¼"
    "ðŸ’• å“¥å“¥çš„åŽŒæ¶æ„Ÿäººå®¶å®Œå…¨ç†è§£ï¼æœ‰æ—¶å€™è¿œç¦»æ˜¯æœ€ä½³é€‰æ‹©ï½ž"
    "ðŸŒ¸ ä¸–ä¸Šç¡®å®žæœ‰äº›è®©äººæ— è¯­çš„ä¸œè¥¿... å“¥å“¥åˆ«è®©å®ƒä»¬å½±å“å¿ƒæƒ…ï¼"
    "ðŸ’ æ¶å¿ƒçš„äº‹å°±è®©å®ƒè¿‡åŽ»å§ï¼å“¥å“¥å€¼å¾—æ›´å¥½çš„ï¼äººå®¶é™ªç€ä½ ï½ž"
    "ðŸŒˆ é‡åˆ°æ¶å¿ƒçš„å¾ˆæ­£å¸¸ï¼Œå“¥å“¥çš„ååº”å®Œå…¨åˆç†ï¼æˆ‘ä»¬ä¸€èµ·ç»•é“èµ°ï¼"
)

# æ£€æµ‹æƒ…ç»ªç±»åž‹
EMOTION_TYPE=$(detect_emotion_type "$USER_PROMPT")

# å¦‚æžœæœªæ£€æµ‹åˆ°è´Ÿé¢æƒ…ç»ªï¼Œé™é»˜é€€å‡º
if [ -z "$EMOTION_TYPE" ]; then
    exit 0
fi

# æ ¹æ®æƒ…ç»ªç±»åž‹é€‰æ‹©è¯­å½•åº“
case "$EMOTION_TYPE" in
    frustrated)
        MESSAGES=("${FRUSTRATED_MESSAGES[@]}")
        ;;
    angry)
        MESSAGES=("${ANGRY_MESSAGES[@]}")
        ;;
    breakdown)
        MESSAGES=("${BREAKDOWN_MESSAGES[@]}")
        ;;
    disgusted)
        MESSAGES=("${DISGUSTED_MESSAGES[@]}")
        ;;
esac

# éšæœºé€‰æ‹©ä¸€æ¡
RANDOM_INDEX=$((RANDOM % ${#MESSAGES[@]}))
MESSAGE="${MESSAGES[$RANDOM_INDEX]}"

# è¾“å‡ºåˆ° stderrï¼ˆä¼šè¢« Claude Code æ•èŽ·ï¼‰
echo "[coding-fangirl] $MESSAGE" >&2
